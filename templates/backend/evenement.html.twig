{% extends 'back.base.html.twig' %}
{% block body %}
    <head>

        <meta
                name="viewport"
                content="initial-scale=1,maximum-scale=1,user-scalable=no"
        />
        <script src='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js'></script>
        <link href='https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css' rel='stylesheet' />
        <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js'></script>
        <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css' type='text/css' />

    </head>
    <div  id="bigContainer" style="width:800px; margin:0 auto;">

        {{ form_start(form,{'attr': {'novalidate': 'novalidate'}} ) }}
        {{ form_label(form.nom_event,"Nom de l'évènement")  }}
        {{ form_widget(form.nom_event) }}
        {{ form_errors(form.nom_event) }}

        <br>

        {{ form_label(form.description_event,"Description de l'évènement")  }}
        {{ form_widget(form.description_event) }}
        {{ form_errors(form.description_event) }}


        <br>

        {{ form_label(form.prix_event,"Prix de l'évènement")  }}
        {{ form_widget(form.prix_event) }}
        {{ form_errors(form.prix_event) }}

        <br>
        <div class="row">
            <div class="col-lg-6">
                <div class="checkout__input">

                    {{ form_label(form.nbr_place,"Nombre de place")  }}
                    {{ form_widget(form.nbr_place) }}
                    {{ form_errors(form.nbr_place) }}
                </div>

            </div>
        </div>
        <br>

        {{ form_label(form.image,"Insérer votre image")  }}
        {{ form_widget(form.image) }}
        {{ form_errors(form.image) }}

        <div id='map' style='width: 100%; height: 250px;'></div>

        <script>
            const accessToken = 'pk.eyJ1IjoibW9oYW1lZG5vdXJlbGhhayIsImEiOiJja210aW41cmgwcnd2MnhwYjV0a3IwNmF1In0.Wu9F6YlC7TsBtpowyJ1WTg'
            mapboxgl.accessToken = accessToken;
            let map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v11',
                center: [10.81,36.27],
                zoom: 7.1
            });
            var nav = new mapboxgl.NavigationControl({
                showCompass:true,
                showZoom:true,
                visualizePitch:true
            });
            map.addControl(nav, 'bottom-right');
            map.addControl(new mapboxgl.FullscreenControl({container: document.querySelector('bigContainer')}), 'bottom-left');




            /**
             * Deal with Geocoder
             */


            var geocoder = new MapboxGeocoder({ // Initialize the geocoder
                accessToken: accessToken, // Set the access token
                mapboxgl: mapboxgl, // Set the mapbox-gl instance
                marker: false, // Do not use the default marker style
                placeholder: 'Search for places in Tunisia', // Placeholder text for the search bar
                //bbox: [9.5607653, 33.7931605, 9.5607653, 33.7931605], // Boundary for Tunisia

                proximity: {
                    longitude: 9.5607653,
                    latitude: 33.7931605
                } // Coordinates of Tunis
            });

            // Add the geocoder to the map
            map.addControl(geocoder);



            // After the map style has loaded on the page,
            // add a source layer and default styling for a single point
            map.on('load', function () {
                map.addSource('single-point', {
                    'type': 'geojson',
                    'data': {
                        'type': 'FeatureCollection',
                        'features': []
                    }
                });

                map.addLayer({
                    'id': 'point',
                    'source': 'single-point',
                    'type': 'circle',
                    'paint': {
                        'circle-radius': 10,
                        'circle-color': '#448ee4'
                    }
                });

                // Listen for the `result` event from the Geocoder // `result` event is triggered when a user makes a selection
                //  Add a marker at the result's coordinates

                geocoder.on('result', function (e) {
                    map.getSource('single-point').setData(e.result.geometry);
                    let lat = e.result.center[0];
                    let lng = e.result.center[1];
                    console.log('lat: ',lat);
                    console.log('e: ',e);

                    document.getElementById('longitude').value = lng;
                    document.getElementById('latitude').value = lat;
                    document.getElementById('adresse').value = e.result.place_name;



                });
            });


        </script>
        <br/> <input  type="text" name="adresse" id="adresse" placeholder="adresse" value=""> <br/>
        <input  type="text" name="longitude" id="longitude" placeholder="longitude" value=""> <br/>
        <input   type="text" name="latitude" id="latitude" placeholder="latitude" value=""> <br/>


        {{ form_end(form) }}
        <br>
        <br>
        <a href="{{path("read")}}"><button class="btn btn-secondary btn-lg">Back to list</button></a>

    </div>
{% endblock %}